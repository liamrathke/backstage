## API Report File for "@backstage/backend-plugin-api"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
import { Config } from '@backstage/config';
import { Handler } from 'express';
import { Logger as Logger_2 } from 'winston';
import { PermissionAuthorizer } from '@backstage/plugin-permission-common';
import { PermissionEvaluator } from '@backstage/plugin-permission-common';
import { PluginCacheManager } from '@backstage/backend-common';
import { PluginDatabaseManager } from '@backstage/backend-common';
import { PluginEndpointDiscovery } from '@backstage/backend-common';
import { PluginTaskScheduler } from '@backstage/backend-tasks';
import { TokenManager } from '@backstage/backend-common';
import { TransportStreamOptions } from 'winston-transport';
import { UrlReader } from '@backstage/backend-common';

// @public (undocumented)
export interface BackendFeature {
  // (undocumented)
  id: string;
  // (undocumented)
  register(reg: BackendRegistrationPoints): void;
}

// @public (undocumented)
export interface BackendLifecycle {
  addShutdownHook(options: BackendLifecycleShutdownHook): void;
}

// @public (undocumented)
export type BackendLifecycleShutdownHook = {
  fn: () => void | Promise<void>;
};

// @public (undocumented)
export interface BackendModuleConfig<TOptions> {
  // (undocumented)
  moduleId: string;
  // (undocumented)
  pluginId: string;
  // (undocumented)
  register(
    reg: Omit<BackendRegistrationPoints, 'registerExtensionPoint'>,
    options: TOptions,
  ): void;
}

// @public (undocumented)
export interface BackendPluginConfig<TOptions> {
  // (undocumented)
  id: string;
  // (undocumented)
  register(reg: BackendRegistrationPoints, options: TOptions): void;
}

// @public (undocumented)
export interface BackendRegistrationPoints {
  // (undocumented)
  registerExtensionPoint<TExtensionPoint>(
    ref: ExtensionPoint<TExtensionPoint>,
    impl: TExtensionPoint,
  ): void;
  // (undocumented)
  registerInit<
    Deps extends {
      [name in string]: unknown;
    },
  >(options: {
    deps: {
      [name in keyof Deps]: ServiceRef<Deps[name]> | ExtensionPoint<Deps[name]>;
    };
    init(deps: Deps): Promise<void>;
  }): void;
}

// @public (undocumented)
export const cacheServiceRef: ServiceRef<PluginCacheManager, 'plugin'>;

// @public (undocumented)
export const configServiceRef: ServiceRef<Config, 'root'>;

// @public
export function createBackendModule<
  TOptions extends object | undefined = undefined,
>(
  config: BackendModuleConfig<TOptions>,
): undefined extends TOptions
  ? (options?: TOptions) => BackendFeature
  : (options: TOptions) => BackendFeature;

// @public (undocumented)
export function createBackendPlugin<
  TOptions extends object | undefined = undefined,
>(config: {
  id: string;
  register(reg: BackendRegistrationPoints, options: TOptions): void;
}): undefined extends TOptions
  ? (options?: TOptions) => BackendFeature
  : (options: TOptions) => BackendFeature;

// @public (undocumented)
export function createExtensionPoint<T>(options: {
  id: string;
}): ExtensionPoint<T>;

// @public (undocumented)
export function createServiceFactory<
  TService,
  TScope extends 'root' | 'plugin',
  TImpl extends TService,
  TDeps extends {
    [name in string]: ServiceRef<unknown>;
  },
  TOpts extends object | undefined = undefined,
>(config: {
  service: ServiceRef<TService, TScope>;
  deps: TDeps;
  factory(
    deps: ServiceRefsToInstances<TDeps, 'root'>,
    options: TOpts,
  ): TScope extends 'root'
    ? Promise<TImpl>
    : Promise<(deps: ServiceRefsToInstances<TDeps>) => Promise<TImpl>>;
}): undefined extends TOpts
  ? (options?: TOpts) => ServiceFactory<TService>
  : (options: TOpts) => ServiceFactory<TService>;

// @public (undocumented)
export function createServiceRef<T>(options: {
  id: string;
  scope?: 'plugin';
  defaultFactory?: (
    service: ServiceRef<T, 'plugin'>,
  ) => Promise<ServiceFactory<T> | (() => ServiceFactory<T>)>;
}): ServiceRef<T, 'plugin'>;

// @public (undocumented)
export function createServiceRef<T>(options: {
  id: string;
  scope: 'root';
  defaultFactory?: (
    service: ServiceRef<T, 'root'>,
  ) => Promise<ServiceFactory<T> | (() => ServiceFactory<T>)>;
}): ServiceRef<T, 'root'>;

// @public (undocumented)
export const databaseServiceRef: ServiceRef<PluginDatabaseManager, 'plugin'>;

// @public (undocumented)
export const discoveryServiceRef: ServiceRef<PluginEndpointDiscovery, 'plugin'>;

// @public
export type ExtensionPoint<T> = {
  id: string;
  T: T;
  toString(): string;
  $$ref: 'extension-point';
};

// @public (undocumented)
export interface HttpRouterService {
  // (undocumented)
  use(handler: Handler): void;
}

// @public (undocumented)
export const httpRouterServiceRef: ServiceRef<HttpRouterService, 'plugin'>;

// @public (undocumented)
export const lifecycleServiceRef: ServiceRef<BackendLifecycle, 'plugin'>;

// @public (undocumented)
export interface Logger {
  // (undocumented)
  child(fields: { [name: string]: string }): Logger;
  // (undocumented)
  info(message: string): void;
}

// @public (undocumented)
export const loggerServiceRef: ServiceRef<Logger, 'plugin'>;

// @public (undocumented)
export function loggerToWinstonLogger(
  logger: Logger,
  opts?: TransportStreamOptions,
): Logger_2;

// @public (undocumented)
export const permissionsServiceRef: ServiceRef<
  PermissionAuthorizer | PermissionEvaluator,
  'plugin'
>;

// @public (undocumented)
export interface PluginMetadata {
  // (undocumented)
  getId(): string;
}

// @public (undocumented)
export const pluginMetadataServiceRef: ServiceRef<PluginMetadata, 'plugin'>;

// @public (undocumented)
export const rootLoggerServiceRef: ServiceRef<Logger, 'root'>;

// @public (undocumented)
export const schedulerServiceRef: ServiceRef<PluginTaskScheduler, 'plugin'>;

// @public (undocumented)
export type ServiceFactory<TService = unknown> =
  | {
      scope: 'root';
      service: ServiceRef<TService, 'root'>;
      deps: {
        [key in string]: ServiceRef<unknown>;
      };
      factory(deps: {
        [key in string]: unknown;
      }): Promise<TService>;
    }
  | {
      scope: 'plugin';
      service: ServiceRef<TService, 'plugin'>;
      deps: {
        [key in string]: ServiceRef<unknown>;
      };
      factory(deps: {
        [key in string]: unknown;
      }): Promise<
        (deps: {
          [key in string]: unknown;
        }) => Promise<TService>
      >;
    };

// @public
export type ServiceRef<
  TService,
  TScope extends 'root' | 'plugin' = 'root' | 'plugin',
> = {
  id: string;
  scope: TScope;
  T: TService;
  toString(): string;
  $$ref: 'service';
};

// @public (undocumented)
export const tokenManagerServiceRef: ServiceRef<TokenManager, 'plugin'>;

// @public (undocumented)
export type TypesToServiceRef<T> = {
  [key in keyof T]: ServiceRef<T[key]>;
};

// @public (undocumented)
export const urlReaderServiceRef: ServiceRef<UrlReader, 'plugin'>;
```
